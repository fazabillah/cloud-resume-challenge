#!/usr/bin/env bash

echo "ğŸ” Testing Backend Counter..."
echo ""

# Get API endpoint
ENDPOINT=$(aws cloudformation describe-stacks \
  --stack-name cloud-resume-backend-counter \
  --region us-east-1 \
  --query 'Stacks[0].Outputs[?OutputKey==`ApiEndpoint`].OutputValue' \
  --output text)

echo "ğŸ“ API Endpoint: $ENDPOINT"
echo ""

# Test API 3 times
echo "ğŸ§ª Testing API (calling 3 times):"
for i in {1..3}; do
  echo "  Call $i:"
  curl -s $ENDPOINT | jq
  sleep 1
done

echo ""
echo "ğŸ“Š DynamoDB Data:"
aws dynamodb scan --table-name ViewCounter --region us-east-1 | jq '.Items[0]'